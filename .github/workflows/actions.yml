name: go_sample github actions

on:
  push:

jobs:
  test:
    name: Run Postman Api Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Postman CLI install
        run: curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh

      - name: Create .env
        run: touch .env

      - name: Add environment variable to .env
        run: |
            echo ENV=dev >> .env
            echo TZ=Asia/Tokyo >> .env
            echo MYSQL_DATABASE=go_sample_db >> .env
            echo MYSQL_USER=go_sample_user >> .env
            echo MYSQL_PASSWORD=go_sample_password >> .env
            echo MYSQL_ROOT_PASSWORD=go_sample_root_password >> .env

      - name: docker compose build --no-cache
        run: docker compose build --no-cache

      - name: docker compose up -d
        run: docker compose up -d

      - name: sleeep 30
        run: sleep 30

      - name: docker compose ps
        run: docker compose ps

      - name: postman collection run
        run: postman collection run src/postman/go_sample_collection.postman_collection.json